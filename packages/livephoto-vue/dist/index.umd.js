(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue"),require("livephotoskit")):typeof define=="function"&&define.amd?define(["exports","vue","livephotoskit"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n.LivePhotoVue={},n.Vue,n.LivePhotosKit))})(this,function(n,e,L){"use strict";function V(a){const l=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const i in a)if(i!=="default"){const s=Object.getOwnPropertyDescriptor(a,i);Object.defineProperty(l,i,s.get?s:{enumerable:!0,get:()=>a[i]})}}return l.default=a,Object.freeze(l)}const E=V(L),N=["src"],R=["src","muted","loop"],m=((a,l)=>{const i=a.__vccOpts||a;for(const[s,f]of l)i[s]=f;return i})(e.defineComponent({__name:"LivePhoto",props:{photoSrc:{default:""},videoSrc:{default:""},muted:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},useApple:{type:Boolean,default:!1}},setup(a){const l=a,i=e.ref(!1),s=e.ref(!1),f=e.ref(!1),b=e.ref(!1),r=e.ref(""),c=e.ref(""),v=e.ref(!1),g=e.ref(!1),u=e.ref(!1),p=e.ref(null),d=e.ref(null),A=async()=>{if(u.value&&d.value&&r.value&&c.value){await e.nextTick();const t=E.Player(d.value);t.photoSrc=r.value,t.videoSrc=c.value}},O=t=>{t.stopPropagation(),p.value&&(f.value?p.value.pause():(s.value=!0,p.value.play()))},j=t=>{var o;(o=window.top)==null||o.postMessage(t,window.location.origin)},x=t=>{const o=t.target;!/trigger/.test(o.className)&&!s.value&&j(r.value)},z=()=>{i.value=!0,/iphone/i.test(navigator.userAgent)&&/micromessenger/i.test(navigator.userAgent)&&setTimeout(()=>{y(!0)},500)},y=t=>{b.value=t},w=t=>{f.value=t},T=t=>{s.value=t},U=()=>{const t=new URLSearchParams(window.location.search),o=t.get("picUrl")||t.get("photoSrc"),P=t.get("videoUrl")||t.get("videoSrc"),S=t.get("muted"),k=t.get("loop"),_=t.get("useApple");o&&(r.value=o),P&&(c.value=P),S&&(v.value=!!S),k&&(g.value=!!k),_&&(u.value=!!_),!o&&l.photoSrc&&(r.value=l.photoSrc),!P&&l.videoSrc&&(c.value=l.videoSrc),S||(v.value=l.muted),k||(g.value=l.loop),_||(u.value=l.useApple)};return e.watch([u,r,c,d],()=>{u.value&&A()},{immediate:!0}),e.onMounted(()=>{U()}),(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"live-photo",onClick:x},[u.value?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"applePlayerRef",ref:d,class:"live-img"},null,512)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createElementVNode("div",{class:"live-trigger",onClick:O,style:e.normalizeStyle({opacity:Number(b.value)})},[e.createElementVNode("div",{class:"trigger-icon",style:e.normalizeStyle({animationPlayState:f.value?"running":"paused"})},null,4),o[5]||(o[5]=e.createElementVNode("span",{class:"trigger-text"},"LIVE",-1))],4),e.createElementVNode("img",{class:"live-img",src:r.value,onLoad:z,style:e.normalizeStyle({opacity:Number(i.value)})},null,44,N),e.createElementVNode("video",{ref_key:"videoRef",ref:p,class:"live-video",src:c.value,style:e.normalizeStyle({opacity:Number(s.value)}),muted:v.value,loop:g.value,playsinline:"","webkit-playsinline":"",onCanplay:o[0]||(o[0]=()=>y(!0)),onLoadedmetadata:o[1]||(o[1]=()=>y(!0)),onPlaying:o[2]||(o[2]=()=>w(!0)),onPause:o[3]||(o[3]=()=>w(!1)),onEnded:o[4]||(o[4]=()=>T(!1))},null,44,R)],64))]))}}),[["__scopeId","data-v-67f2bfe9"]]),h=a=>{a.component("LivePhoto",m)},B={install:h,LivePhoto:m};n.LivePhoto=m,n.default=B,n.install=h,Object.defineProperties(n,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
